<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TSR - {{ project }} {{ release }}</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: #1a1a1a;
            background: #f8fafc;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            min-height: 100vh;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }
        
        /* Header */
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }
        
        .header .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .header .meta {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin-top: 1rem;
            flex-wrap: wrap;
        }
        
        .header .meta-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        /* Tab Navigation */
        .tab-nav {
            background: #f8fafc;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            overflow-x: auto;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }
        
        .tab-nav::-webkit-scrollbar {
            display: none;
        }
        
        .tab-button {
            background: none;
            border: none;
            padding: 1rem 1.5rem;
            cursor: pointer;
            font-size: 0.95rem;
            font-weight: 500;
            color: #64748b;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
            white-space: nowrap;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .tab-button:hover {
            background: #e2e8f0;
            color: #334155;
        }
        
        .tab-button.active {
            color: #667eea;
            border-bottom-color: #667eea;
            background: white;
        }
        
        .tab-button .icon {
            font-size: 1.1rem;
        }
        
        /* Collapsible Sections */
        .collapsible-section {
            margin-bottom: 1.5rem;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            overflow: hidden;
            background: white;
        }
        
        .collapsible-header {
            width: 100%;
            background: #f8fafc;
            border: none;
            padding: 1rem 1.5rem;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 1rem;
            font-weight: 600;
            color: #374151;
            transition: background-color 0.2s ease;
        }
        
        .collapsible-header:hover {
            background: #e2e8f0;
        }
        
        .section-title {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .toggle-icon {
            font-size: 0.9rem;
            transition: transform 0.3s ease;
        }
        
        .collapsible-content {
            max-height: 2000px;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }
        
        .collapsible-content.collapsed {
            max-height: 0;
            transition: max-height 0.3s ease-in;
        }
        
        .collapsible-content .content-wrapper {
            padding: 1.5rem;
        }
        
        /* Tab Content */
        .tab-content {
            display: none;
            padding: 2rem;
            animation: fadeIn 0.3s ease-in-out;
        }
        
        .tab-content.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Executive Summary */
        .exec-summary {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            border: 1px solid #bae6fd;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .exec-summary h2 {
            color: #0369a1;
            margin-bottom: 1rem;
            font-size: 1.3rem;
        }
        
        .exec-summary p {
            margin-bottom: 0.5rem;
            font-size: 1rem;
        }
        
        /* Tables */
        .table-container {
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
        }
        
        .table-container h2 {
            background: #f8fafc;
            padding: 1rem 1.5rem;
            margin: 0;
            border-bottom: 1px solid #e2e8f0;
            font-size: 1.2rem;
            color: #1e293b;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th, td {
            padding: 0.75rem 1rem;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
        }
        
        th {
            background: #f8fafc;
            font-weight: 600;
            color: #374151;
            font-size: 0.9rem;
        }
        
        tbody tr:hover {
            background: #f8fafc;
        }
        
        /* Status Badges */
        .status-badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.8rem;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        .status-passed {
            background: #dcfce7;
            color: #166534;
        }
        
        .status-failed {
            background: #fef2f2;
            color: #dc2626;
        }
        
        .status-blocked {
            background: #fef3c7;
            color: #d97706;
        }
        
        .status-critical {
            background: #fef2f2;
            color: #991b1b;
        }
        
        .status-major {
            background: #fed7aa;
            color: #9a3412;
        }
        
        .status-medium {
            background: #fef3c7;
            color: #92400e;
        }
        
        .status-minor {
            background: #dbeafe;
            color: #1e40af;
        }
        
        /* Bug Status Colors */
        .status-open {
            background: #fef2f2;
            color: #dc2626;
        }
        
        .status-closed {
            background: #dcfce7;
            color: #166534;
        }
        
        .status-fixed {
            background: #dcfce7;
            color: #166534;
        }
        
        .status-resolved {
            background: #dcfce7;
            color: #166534;
        }
        
        .status-verified {
            background: #dbeafe;
            color: #1e40af;
        }
        
        .status-reopened {
            background: #fef3c7;
            color: #d97706;
        }
        
        .status-in-progress {
            background: #fef3c7;
            color: #d97706;
        }
        
        .status-pending {
            background: #f3f4f6;
            color: #6b7280;
        }
        
        /* Charts */
        .chart-container {
            text-align: center;
            margin: 1rem 0;
        }
        
        .chart-container img {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: transform 0.2s ease;
        }
        
        .chart-container img:hover {
            transform: scale(1.02);
        }
        
        /* Quality Gate */
        .quality-gate {
            background: white;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            border-left: 4px solid;
        }
        
        .quality-gate.approved {
            border-left-color: #10b981;
            background: #f0fdf4;
        }
        
        .quality-gate.conditional {
            border-left-color: #f59e0b;
            background: #fffbeb;
        }
        
        .quality-gate.rejected {
            border-left-color: #ef4444;
            background: #fef2f2;
        }
        
        .quality-gate h3 {
            margin-bottom: 1rem;
            font-size: 1.2rem;
        }
        
        /* Sign-off */
        .sign-off {
            background: #f8fafc;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .sign-off h3 {
            margin-bottom: 1rem;
            color: #1e293b;
        }
        
        .sign-off-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }
        
        .sign-off-item {
            background: white;
            padding: 1rem;
            border-radius: 6px;
            border: 1px solid #e2e8f0;
        }
        
        .sign-off-item strong {
            display: block;
            color: #374151;
            margin-bottom: 0.5rem;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .container {
                margin: 0;
                box-shadow: none;
            }
            
            .header .meta {
                flex-direction: column;
                gap: 0.5rem;
            }
            
            .tab-content {
                padding: 1rem;
            }
            
            .table-container {
                overflow-x: auto;
            }
            
            table {
                min-width: 600px;
            }
        }
        
        /* Print Styles */
        @media print {
            .tab-nav {
                display: none;
            }
            
            .tab-content {
                display: block !important;
                page-break-inside: avoid;
            }
            
            .container {
                box-shadow: none;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>Test Summary Report</h1>
            <div class="subtitle">{{ project }} - {{ release }}</div>
            <div class="meta">
                <div class="meta-item">
                    <span>üìÖ</span>
                    <span>{{ report_date }}</span>
                </div>
                <div class="meta-item">
                    <span>üåç</span>
                    <span>{{ environment }}</span>
                </div>
                <div class="meta-item">
                    <span>üìä</span>
                    <span>{{ total_tests }} Tests</span>
                </div>
                <div class="meta-item">
                    <span>‚úÖ</span>
                    <span>{{ pass_rate }}% Pass Rate</span>
                </div>
            </div>
        </div>

        <!-- Tab Navigation -->
        <div class="tab-nav">
            <button class="tab-button active" onclick="showTab('overview')">
                <span class="icon">üìä</span>
                <span>Overview</span>
            </button>
            <button class="tab-button" onclick="showTab('testdetails')">
                <span class="icon">üîç</span>
                <span>Test Details</span>
            </button>
            <button class="tab-button" onclick="showTab('defects')">
                <span class="icon">üêõ</span>
                <span>Defects</span>
            </button>
            <button class="tab-button" onclick="showTab('modules')">
                <span class="icon">üèóÔ∏è</span>
                <span>Modules</span>
            </button>
            <button class="tab-button" onclick="showTab('analysis')">
                <span class="icon">üìà</span>
                <span>Analysis</span>
            </button>
            <button class="tab-button" onclick="showTab('signoff')">
                <span class="icon">‚úçÔ∏è</span>
                <span>Sign-off</span>
            </button>
        </div>

        <!-- Tab Content -->
        <div id="overview" class="tab-content active">
            <!-- Executive Summary -->
            <div class="exec-summary">
                <h2>Executive Summary</h2>
                <p><strong>Test Execution:</strong> {{ total_tests }} total tests, {{ executed_tests }} executed ({{ pass_rate }}% pass rate)</p>
                <p><strong>Defects:</strong> {{ (defects.critical.open + defects.major.open + defects.medium.open + defects.minor.open) }} total defects identified ({{ defects.critical.open }} critical, {{ defects.major.open }} major, {{ defects.medium.open }} medium, {{ defects.minor.open }} minor)</p>
                <p><strong>Status:</strong> 
                {% if quality_gate_evaluation.release_recommendation == 'APPROVED' %}
                    ‚úÖ Ready for release
                {% elif quality_gate_evaluation.release_recommendation == 'CONDITIONAL' %}
                    ‚ö†Ô∏è Conditional release
                {% else %}
                    ‚ùå Requires immediate action
                {% endif %}
                </p>
            </div>

            <!-- Key Metrics -->
            <div class="metrics-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem; margin: 2rem 0;">
                <div class="metric-card" style="background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 8px; padding: 1.5rem; text-align: center;">
                    <div style="font-size: 2rem; font-weight: bold; color: #1e293b;">{{ total_tests }}</div>
                    <div style="color: #64748b; font-size: 0.9rem;">Total Tests</div>
                </div>
                <div class="metric-card" style="background: #f0f9ff; border: 1px solid #bae6fd; border-radius: 8px; padding: 1.5rem; text-align: center;">
                    <div style="font-size: 2rem; font-weight: bold; color: #0369a1;">{{ executed_tests or (total_tests - skipped_tests) }}</div>
                    <div style="color: #64748b; font-size: 0.9rem;">Executed</div>
                    <div style="color: #0369a1; font-size: 0.8rem; margin-top: 0.5rem;">{{ "%.1f"|format(((executed_tests or (total_tests - skipped_tests))/total_tests*100) if total_tests > 0 else 0) }}%</div>
                </div>
                <div class="metric-card" style="background: #f0fdf4; border: 1px solid #bbf7d0; border-radius: 8px; padding: 1.5rem; text-align: center;">
                    <div style="font-size: 2rem; font-weight: bold; color: #166534;">{{ passed_tests }}</div>
                    <div style="color: #64748b; font-size: 0.9rem;">Passed</div>
                    <div style="color: #166534; font-size: 0.8rem; margin-top: 0.5rem;">{{ "%.1f"|format(pass_rate) }}%</div>
                </div>
                <div class="metric-card" style="background: #fef2f2; border: 1px solid #fecaca; border-radius: 8px; padding: 1.5rem; text-align: center;">
                    <div style="font-size: 2rem; font-weight: bold; color: #dc2626;">{{ failed_tests }}</div>
                    <div style="color: #64748b; font-size: 0.9rem;">Failed</div>
                    <div style="color: #dc2626; font-size: 0.8rem; margin-top: 0.5rem;">{{ "%.1f"|format((failed_tests/total_tests*100) if total_tests > 0 else 0) }}%</div>
                </div>
                <div class="metric-card" style="background: #fef3c7; border: 1px solid #fed7aa; border-radius: 8px; padding: 1.5rem; text-align: center;">
                    <div style="font-size: 2rem; font-weight: bold; color: #d97706;">{{ blocked_tests or 0 }}</div>
                    <div style="color: #64748b; font-size: 0.9rem;">Blocked</div>
                </div>
                <div class="metric-card" style="background: #f3f4f6; border: 1px solid #d1d5db; border-radius: 8px; padding: 1.5rem; text-align: center;">
                    <div style="font-size: 2rem; font-weight: bold; color: #374151;">{{ skipped_tests }}</div>
                    <div style="color: #64748b; font-size: 0.9rem;">Skipped</div>
                </div>
            </div>


            <!-- Quality Gate (Collapsible) -->
            <div class="collapsible-section">
                <button class="collapsible-header" onclick="toggleCollapsible('quality-gate')">
                    <span class="section-title">üéØ Quality Gate Evaluation</span>
                    <span class="toggle-icon">‚ñ∂</span>
                </button>
                <div class="collapsible-content" id="quality-gate">
                    <div class="content-wrapper">
                        <div class="quality-gate {{ quality_gate_evaluation.release_recommendation.lower() }}">
                            <h3>Quality Gate Evaluation</h3>
                            <p><strong>Recommendation:</strong> {{ quality_gate_evaluation.release_recommendation }}</p>
                            <p><strong>Gate Used:</strong> {{ quality_gate_evaluation.gate_name }}</p>
                            {% if quality_gate_evaluation.details %}
                            <p><strong>Details:</strong> {{ quality_gate_evaluation.details }}</p>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>

        </div>

        <div id="analysis" class="tab-content">

            <!-- Key Findings and Insights (Collapsible) -->
            <div class="collapsible-section">
                <button class="collapsible-header" onclick="toggleCollapsible('ai-insights')">
                    <span class="section-title">üîç Key Findings & Insights</span>
                    <span class="toggle-icon">‚ñ∂</span>
                </button>
                <div class="collapsible-content" id="ai-insights">
                    <div class="content-wrapper">
                        <div class="table-container">
                            <h2>Key Findings</h2>
                            <div style="padding: 1.5rem;">
                                <h3>Stable Areas</h3>
                                <ul>
                                    {% if pass_rate >= 90 %}
                                        <li><strong>Overall Quality:</strong> Pass rate of {{ "%.1f"|format(pass_rate) }}% meets stability threshold</li>
                                        <li><strong>Quality Assessment:</strong> System demonstrates good stability with high pass rate</li>
                                    {% else %}
                                        <li><strong>Quality Assessment:</strong> No modules achieved the 90% pass rate threshold required for "stable" classification</li>
                                        <li><strong>Current Status:</strong> All tested modules show performance below the stability threshold, indicating widespread quality concerns</li>
                                        <li><strong>Risk Level:</strong> High - The overall test execution results suggest significant quality issues that need immediate attention</li>
                                        <li><strong>Recommendation:</strong> Focus on identifying and addressing root causes of failures before proceeding with release</li>
                                    {% endif %}
                                </ul>
                                
                                <div style="margin: 2rem 0;"></div>
                                
                                <h3>Risky Areas</h3>
                                <ul>
                                    {% if pass_rate < 95 %}
                                    <li><strong>Overall Quality Risk:</strong> Pass rate of {{ "%.1f"|format(pass_rate) }}% is below conditional threshold (95%)</li>
                                    {% endif %}
                                    {% if (defects.critical.open or 0) > 0 %}
                                    <li><strong>Critical Defects:</strong> {{ defects.critical.open }} critical defects require immediate attention</li>
                                    {% endif %}
                                    {% if (defects.major.open or 0) > 2 %}
                                    <li><strong>Major Defect Volume:</strong> {{ defects.major.open }} major defects exceed acceptable limit (2)</li>
                                    {% endif %}
                                    {% if modules_covered %}
                                        {% for module, data in modules_covered.items() %}
                                            {% if (data.passed or 0) / (data.total or 1) * 100 < 75 %}
                                            <li><strong>{{ module }} module</strong> needs attention with {{ "%.1f"|format((data.passed or 0) / (data.total or 1) * 100) }}% pass rate</li>
                                            {% endif %}
                                        {% endfor %}
                                    {% endif %}
                                    {% if density %}
                                        {% for module, data in density.items() %}
                                            {% if data.get('density_percentage', 0) > 50 %}
                                            <li><strong>{{ module }} module</strong> shows high defect density ({{ "%.1f"|format(data.get('density_percentage', 0)) }}%)</li>
                                            {% endif %}
                                        {% endfor %}
                                    {% endif %}
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div style="margin: 2rem 0;"></div>

            <!-- Lessons Learned (Collapsible) -->
            <div class="collapsible-section">
                <button class="collapsible-header" onclick="toggleCollapsible('trend-analysis')">
                    <span class="section-title">üìö Lessons Learned</span>
                    <span class="toggle-icon">‚ñ∂</span>
                </button>
                <div class="collapsible-content" id="trend-analysis">
                    <div class="content-wrapper">
                        <div class="table-container">
                            <h2>Lessons Learned</h2>
                            <div style="padding: 1.5rem;">
                                <h3>What Went Well</h3>
                                <ul>
                                    {% if lessons_learned and lessons_learned.get('successes') %}
                                        {% for item in lessons_learned.get('successes', []) %}
                                        <li>{{ item }}</li>
                                        {% endfor %}
                                    {% else %}
                                        <li>Excellent test execution rate of {{ "%.1f"|format((executed_tests/total_tests*100) if total_tests > 0 else 0) }}% ({{ executed_tests }}/{{ total_tests }} tests)</li>
                                        <li>No blocked tests - test environment was stable</li>
                                        <li>No flaky tests identified - test reliability is good</li>
                                    {% endif %}
                                </ul>
                                
                                <div style="margin: 2rem 0;"></div>
                                
                                <h3>Areas for Improvement</h3>
                                <ul>
                                    <li>Low pass rate of {{ "%.1f"|format(pass_rate) }}% indicates quality concerns</li>
                                    {% if (defects.critical.open or 0) > 0 %}
                                    <li>{{ defects.critical.open }} critical defect(s) require immediate attention</li>
                                    {% endif %}
                                    {% if (defects.major.open or 0) > 0 %}
                                    <li>High number of major defects ({{ defects.major.open }}) indicates quality issues</li>
                                    {% endif %}
                                    {% if modules_covered %}
                                        {% set high_defect_modules = [] %}
                                        {% for module, data in modules_covered.items() %}
                                            {% if (data.passed or 0) / (data.total or 1) * 100 < 50 %}
                                                {% set _ = high_defect_modules.append(module) %}
                                            {% endif %}
                                        {% endfor %}
                                        {% if high_defect_modules %}
                                        <li>Low pass rates in modules: {{ high_defect_modules | join(', ') }}</li>
                                        {% endif %}
                                    {% endif %}
                                    {% if density %}
                                        {% set high_density_modules = [] %}
                                        {% for module, data in density.items() %}
                                            {% if data.get('density_percentage', 0) > 50 %}
                                                {% set _ = high_density_modules.append(module) %}
                                            {% endif %}
                                        {% endfor %}
                                        {% if high_density_modules %}
                                        <li>High defect density in modules: {{ high_density_modules | join(', ') }}</li>
                                        {% endif %}
                                    {% endif %}
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Variances & Deviations (Collapsible) -->
            <div class="collapsible-section">
                <button class="collapsible-header" onclick="toggleCollapsible('risk-assessment')">
                    <span class="section-title">‚ö†Ô∏è Variances & Deviations</span>
                    <span class="toggle-icon">‚ñ∂</span>
                </button>
                <div class="collapsible-content" id="risk-assessment">
                    <div class="content-wrapper">
                        <div class="table-container">
                            <h2>Variances/Deviations</h2>
                            <div style="padding: 1.5rem;">
                                <h3>Test Execution Variances</h3>
                                <ul>
                                    {% if pass_rate < 75 %}
                                    <li style="margin-bottom: 0.5rem; padding: 0.5rem; background: #fef2f2; border-left: 3px solid #ef4444; border-radius: 4px;">
                                        <strong>Pass Rate Deviation:</strong> Pass rate of {{ "%.1f"|format(pass_rate) }}% is significantly below expected threshold. Quality concerns may indicate widespread issues. Conduct root cause analysis and implement quality gates.
                                    </li>
                                    {% endif %}
                                    
                                    {% if (defects.critical.open or 0) > 0 %}
                                    <li style="margin-bottom: 0.5rem; padding: 0.5rem; background: #fef2f2; border-left: 3px solid #ef4444; border-radius: 4px;">
                                        <strong>Critical Defect Deviation:</strong> {{ defects.critical.open }} critical defect(s) found - release blocker. Critical functionality is compromised, release should be delayed. Immediate defect resolution and re-testing required.
                                    </li>
                                    {% endif %}
                                    
                                    {% if (defects.major.open or 0) > 2 %}
                                    <li style="margin-bottom: 0.5rem; padding: 0.5rem; background: #fef3c7; border-left: 3px solid #f59e0b; border-radius: 4px;">
                                        <strong>Major Defect Deviation:</strong> {{ defects.major.open }} major defect(s) exceed acceptable threshold. Significant functionality issues may impact user experience. Prioritize major defect resolution before release.
                                    </li>
                                    {% endif %}
                                    
                                    {% if modules_covered %}
                                        {% set high_defect_modules = [] %}
                                        {% for module, data in modules_covered.items() %}
                                            {% if (data.passed or 0) / (data.total or 1) * 100 < 50 %}
                                                {% set _ = high_defect_modules.append(module) %}
                                            {% endif %}
                                        {% endfor %}
                                        {% if high_defect_modules %}
                                        <li style="margin-bottom: 0.5rem; padding: 0.5rem; background: #fef3c7; border-left: 3px solid #f59e0b; border-radius: 4px;">
                                            <strong>Module Pass Rate Deviation:</strong> Low pass rates in modules: {{ high_defect_modules | join(', ') }}. Specific modules show poor quality indicators. Review and improve test cases for low-performing modules.
                                        </li>
                                        {% endif %}
                                    {% endif %}
                                    
                                    {% if density %}
                                        {% set high_density_modules = [] %}
                                        {% for module, data in density.items() %}
                                            {% if data.get('density_percentage', 0) > 50 %}
                                                {% set _ = high_density_modules.append(module) %}
                                            {% endif %}
                                        {% endfor %}
                                        {% if high_density_modules %}
                                        <li style="margin-bottom: 0.5rem; padding: 0.5rem; background: #fef3c7; border-left: 3px solid #f59e0b; border-radius: 4px;">
                                            <strong>Module Defect Density Deviation (High):</strong> High defect density in modules: {{ high_density_modules | join(', ') }}. Specific modules show excessive defect rates. Focus additional testing and development effort on high-defect modules.
                                        </li>
                                        {% endif %}
                                    {% endif %}
                                    
                                    {% if not variances %}
                                    <li style="margin-bottom: 0.5rem; padding: 0.5rem; background: #f0fdf4; border-left: 3px solid #10b981; border-radius: 4px;">
                                        <strong>No Significant Variances:</strong> Test execution proceeded as planned with no major deviations from expected outcomes.
                                    </li>
                                    {% endif %}
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>

        <div id="modules" class="tab-content">
            <!-- Test Analytics Charts (Always Visible) -->
            <div class="charts-section" style="margin-bottom: 2rem;">
                <h2>Test Analytics</h2>
                <div class="charts-grid" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem;">
                    <div class="chart-card" style="background: white; border-radius: 8px; padding: 1rem; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                        <h3 style="margin-bottom: 1rem; color: #1e293b;">Test Results</h3>
                        <img src="assets/pass_fail.png" alt="Test Results Chart" onclick="openModal('Test Results Summary', 'assets/pass_fail.png')" style="width: 100%; height: auto; border-radius: 4px; cursor: pointer;" />
                    </div>
                    <div class="chart-card" style="background: white; border-radius: 8px; padding: 1rem; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                        <h3 style="margin-bottom: 1rem; color: #1e293b;">Failures by Module</h3>
                        <img src="assets/fail_by_module.png" alt="Module Results Chart" onclick="openModal('Test Failures by Module', 'assets/fail_by_module.png')" style="width: 100%; height: auto; border-radius: 4px; cursor: pointer;" />
                    </div>
                </div>
            </div>

            <!-- Module Performance Overview (Collapsible) -->
            <div class="collapsible-section">
                <button class="collapsible-header" onclick="toggleCollapsible('module-summary')">
                    <span class="section-title">üìä Test Execution Summary by Module</span>
                    <span class="toggle-icon">‚ñ∂</span>
                </button>
                <div class="collapsible-content" id="module-summary">
                    <div class="content-wrapper">
                        <table>
                            <thead>
                                <tr>
                                    <th>Module</th>
                                    <th>Total Tests</th>
                                    <th>Executed</th>
                                    <th>Passed</th>
                                    <th>Failed</th>
                                    <th>Pass Rate</th>
                                    <th>Quality Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for module, data in modules_covered.items() %}
                                <tr>
                                    <td><strong>{{ module }}</strong></td>
                                    <td>{{ data.total or 0 }}</td>
                                    <td>{{ data.total or 0 }}</td>
                                    <td><span class="status-badge status-passed">{{ data.passed or 0 }}</span></td>
                                    <td><span class="status-badge status-failed">{{ data.failed or 0 }}</span></td>
                                    <td>{{ ((data.passed or 0) / (data.total or 1) * 100) | round(1) }}%</td>
                                    <td>
                                        {% set module_pass_rate = (data.passed or 0) / (data.total or 1) * 100 %}
                                        {% if module_pass_rate >= 90 %}
                                            <span class="status-badge status-passed">Excellent</span>
                                        {% elif module_pass_rate >= 75 %}
                                            <span class="status-badge status-passed">Good</span>
                                        {% elif module_pass_rate >= 50 %}
                                            <span class="status-badge status-blocked">Needs Attention</span>
                                        {% else %}
                                            <span class="status-badge status-failed">Critical</span>
                                        {% endif %}
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>


            <!-- Module Comparison (Collapsible) -->
            <div class="collapsible-section">
                <button class="collapsible-header" onclick="toggleCollapsible('module-comparison')">
                    <span class="section-title">üîç Module Comparison & Analysis</span>
                    <span class="toggle-icon">‚ñ∂</span>
                </button>
                <div class="collapsible-content" id="module-comparison">
                    <div class="content-wrapper">
                        <!-- Defect Density Analysis -->
                        {% if density %}
                        <div class="table-container">
                            <h2>Defect Density per Module</h2>
                            <table>
                                <thead>
                                    <tr>
                                        <th>Module</th>
                                        <th>Total Defects</th>
                                        <th>Total Tests</th>
                                        <th>Density %</th>
                                        <th>Critical</th>
                                        <th>Major</th>
                                        <th>Medium</th>
                                        <th>Minor</th>
                                        <th>Risk Level</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for module, data in density.items() %}
                                    <tr>
                                        <td><strong>{{ module }}</strong></td>
                                        <td>{{ data.get('total', 0) }}</td>
                                        <td>{{ data.get('total_tests', 0) }}</td>
                                        <td>{{ "%.1f"|format(data.get('density_percentage', 0)) }}%</td>
                                        <td>{{ data.get('critical', 0) }}</td>
                                        <td>{{ data.get('major', 0) }}</td>
                                        <td>{{ data.get('medium', 0) }}</td>
                                        <td>{{ data.get('minor', 0) }}</td>
                                        <td>
                                            {% set risk_level = data.get('risk_level', 'Low') %}
                                            {% if risk_level == 'High' %}
                                                <span class="status-badge status-critical" style="background: #fef2f2; color: #dc2626; border: 1px solid #fecaca;">{{ risk_level }}</span>
                                            {% elif risk_level == 'Medium' %}
                                                <span class="status-badge status-failed" style="background: #fef3c7; color: #d97706; border: 1px solid #fde68a;">{{ risk_level }}</span>
                                            {% else %}
                                                <span class="status-badge status-passed" style="background: #f0fdf4; color: #166534; border: 1px solid #bbf7d0;">{{ risk_level }}</span>
                                            {% endif %}
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                        {% endif %}

                        <!-- Module Risk Assessment -->
                        <div class="table-container">
                            <h2>Module Risk Assessment</h2>
                            <div style="padding: 1.5rem;">
                                <h3>High Risk Modules</h3>
                                {% set high_risk_modules = [] %}
                                {% for module, data in modules_covered.items() %}
                                    {% set module_pass_rate = (data.passed or 0) / (data.total or 1) * 100 %}
                                    {% if module_pass_rate < 75 %}
                                        {% set _ = high_risk_modules.append({'name': module, 'rate': module_pass_rate}) %}
                                    {% endif %}
                                {% endfor %}
                                
                                {% if high_risk_modules %}
                                <ul>
                                    {% for module in high_risk_modules %}
                                    <li><strong>{{ module.name }}:</strong> {{ "%.1f"|format(module.rate) }}% pass rate - Requires immediate attention</li>
                                    {% endfor %}
                                </ul>
                                {% else %}
                                <p style="color: #059669; font-style: italic;">‚úÖ No high-risk modules identified - All modules are performing within acceptable thresholds.</p>
                                {% endif %}
                                
                                <div style="margin: 2rem 0;"></div>
                                
                                <h3>Stable Modules</h3>
                                {% set stable_modules = [] %}
                                {% for module, data in modules_covered.items() %}
                                    {% set module_pass_rate = (data.passed or 0) / (data.total or 1) * 100 %}
                                    {% if module_pass_rate >= 90 %}
                                        {% set _ = stable_modules.append({'name': module, 'rate': module_pass_rate}) %}
                                    {% endif %}
                                {% endfor %}
                                
                                {% if stable_modules %}
                                <ul>
                                    {% for module in stable_modules %}
                                    <li><strong>{{ module.name }}:</strong> {{ "%.1f"|format(module.rate) }}% pass rate - Excellent performance</li>
                                    {% endfor %}
                                </ul>
                                {% else %}
                                <p style="color: #d97706; font-style: italic;">‚ö†Ô∏è No modules currently meet the "Stable" criteria (‚â•90% pass rate). Consider focusing on improving test coverage and debugging for modules with lower pass rates.</p>
                                {% endif %}
                                
                                <div style="margin: 2rem 0;"></div>
                                
                                <h3>Module Performance Summary</h3>
                                <div style="background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 8px; padding: 1rem; margin-top: 1rem;">
                                    <p><strong>Analysis Results:</strong></p>
                                    <ul style="margin: 0.5rem 0;">
                                        <li>High Risk Modules: {{ high_risk_modules|length }}</li>
                                        <li>Stable Modules: {{ stable_modules|length }}</li>
                                        <li>Total Modules Analyzed: {{ modules_covered|length }}</li>
                                    </ul>
                                    {% if high_risk_modules|length == 0 and stable_modules|length == 0 %}
                                    <p style="color: #64748b; font-style: italic; margin-top: 0.5rem;">All modules fall into the moderate performance range (75-89% pass rate).</p>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>

        <div id="testdetails" class="tab-content">
            <!-- Test Execution Summary -->
            <div class="table-container">
                <h2>Test Execution Overview</h2>
                <div style="padding: 1.5rem;">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
                        <div style="background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 8px; padding: 1rem; text-align: center;">
                            <div style="font-size: 1.5rem; font-weight: bold; color: #1e293b;">{{ total_tests }}</div>
                            <div style="color: #64748b;">Total Test Cases</div>
                        </div>
                        <div style="background: #f0fdf4; border: 1px solid #bbf7d0; border-radius: 8px; padding: 1rem; text-align: center;">
                            <div style="font-size: 1.5rem; font-weight: bold; color: #166534;">{{ passed_tests }}</div>
                            <div style="color: #64748b;">Passed Tests</div>
                        </div>
                        <div style="background: #fef2f2; border: 1px solid #fecaca; border-radius: 8px; padding: 1rem; text-align: center;">
                            <div style="font-size: 1.5rem; font-weight: bold; color: #dc2626;">{{ failed_tests }}</div>
                            <div style="color: #64748b;">Failed Tests</div>
                        </div>
                        <div style="background: #f0f9ff; border: 1px solid #bae6fd; border-radius: 8px; padding: 1rem; text-align: center;">
                            <div style="font-size: 1.5rem; font-weight: bold; color: #0369a1;">{{ "%.1f"|format(pass_rate) }}%</div>
                            <div style="color: #64748b;">Pass Rate</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Individual Test Results (Collapsible) -->
            <div class="collapsible-section">
                <button class="collapsible-header" onclick="toggleCollapsible('test-results')">
                    <span class="section-title">üìã All Test Case Results</span>
                    <span class="toggle-icon">‚ñ∂</span>
                </button>
                <div class="collapsible-content" id="test-results">
                    <div class="content-wrapper">
                        <div class="table-container">
                            <h2>Complete Test Execution Details</h2>
                            <table>
                                <thead>
                                    <tr>
                                        <th>Test Case ID</th>
                                        <th>Test Name</th>
                                        <th>Module</th>
                                        <th>Priority</th>
                                        <th>Status</th>
                                        <th>Execution Time</th>
                                        <th>Tester</th>
                                        <th>Environment</th>
                                        <th>Browser</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for test in test_data %}
                                    <tr>
                                        <td><strong>{{ test.get('TestCaseID', 'N/A') }}</strong></td>
                                        <td>{{ test.get('Description', test.get('Test Name', 'N/A')) }}</td>
                                        <td>{{ test.get('Module', 'N/A') }}</td>
                                        <td>
                                            {% set priority = test.get('Priority', '') %}
                                            {% if priority and priority != '' and priority != 'nan' %}
                                                {% if priority == 'High' or priority == 'Critical' %}
                                                    <span class="status-badge status-critical">{{ priority }}</span>
                                                {% elif priority == 'Medium' %}
                                                    <span class="status-badge status-blocked">{{ priority }}</span>
                                                {% else %}
                                                    <span class="status-badge status-passed">{{ priority }}</span>
                                                {% endif %}
                                            {% else %}
                                                <span style="color: #64748b; font-style: italic;">N/A</span>
                                            {% endif %}
                                        </td>
                                        <td>
                                            {% set status = test.get('Result', test.get('Status', 'N/A')) %}
                                            {% if status == 'Pass' %}
                                                <span class="status-badge status-passed">Pass</span>
                                            {% elif status == 'Fail' %}
                                                <span class="status-badge status-failed">Fail</span>
                                            {% else %}
                                                <span class="status-badge status-blocked">{{ status }}</span>
                                            {% endif %}
                                        </td>
                                        <td>
                                            {% set exec_time = test.get('Duration', test.get('Execution Time (ms)', '')) %}
                                            {% if exec_time and exec_time != '' and exec_time != 'nan' %}
                                                {{ exec_time }}ms
                                            {% else %}
                                                <span style="color: #64748b; font-style: italic;">N/A</span>
                                            {% endif %}
                                        </td>
                                        <td>
                                            {% set tester = test.get('Tester', '') %}
                                            {% if tester and tester != '' and tester != 'nan' %}
                                                {{ tester }}
                                            {% else %}
                                                <span style="color: #64748b; font-style: italic;">N/A</span>
                                            {% endif %}
                                        </td>
                                        <td>
                                            {% set environment = test.get('Environment', '') %}
                                            {% if environment and environment != '' and environment != 'nan' %}
                                                {{ environment }}
                                            {% else %}
                                                <span style="color: #64748b; font-style: italic;">N/A</span>
                                            {% endif %}
                                        </td>
                                        <td>
                                            {% set browser = test.get('Browser', '') %}
                                            {% if browser and browser != '' and browser != 'nan' %}
                                                {{ browser }}
                                            {% else %}
                                                <span style="color: #64748b; font-style: italic;">N/A</span>
                                            {% endif %}
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Failed Test Details (Collapsible) -->
            <div class="collapsible-section">
                <button class="collapsible-header" onclick="toggleCollapsible('failed-tests')">
                    <span class="section-title">‚ùå Failed Test Cases ({{ failed_tests }})</span>
                    <span class="toggle-icon">‚ñ∂</span>
                </button>
                <div class="collapsible-content" id="failed-tests">
                    <div class="content-wrapper">
                        <div class="table-container">
                            <h2>Failed Test Cases Analysis</h2>
                            <table>
                                <thead>
                                    <tr>
                                        <th>Test Case ID</th>
                                        <th>Test Name</th>
                                        <th>Module</th>
                                        <th>Priority</th>
                                        <th>Error Message</th>
                                        <th>Severity</th>
                                        <th>Bug ID</th>
                                        <th>Execution Time</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for test in test_data %}
                                        {% if test.get('Result', test.get('Status', '')) == 'Fail' %}
                                        <tr>
                                            <td><strong>{{ test.get('TestCaseID', 'N/A') }}</strong></td>
                                            <td>{{ test.get('Description', test.get('Test Name', 'N/A')) }}</td>
                                            <td>{{ test.get('Module', 'N/A') }}</td>
                                            <td>
                                                {% set priority = test.get('Priority', '') %}
                                                {% if priority and priority != '' and priority != 'nan' %}
                                                    {% if priority == 'High' or priority == 'Critical' %}
                                                        <span class="status-badge status-critical">{{ priority }}</span>
                                                    {% elif priority == 'Medium' %}
                                                        <span class="status-badge status-blocked">{{ priority }}</span>
                                                    {% else %}
                                                        <span class="status-badge status-passed">{{ priority }}</span>
                                                    {% endif %}
                                                {% else %}
                                                    <span style="color: #64748b; font-style: italic;">N/A</span>
                                                {% endif %}
                                            </td>
                                            <td style="max-width: 200px; word-wrap: break-word;">{{ test.get('Error Message', 'N/A') }}</td>
                                            <td>
                                                {% set severity = test.get('Severity', 'N/A') %}
                                                {% if severity == 'Critical' %}
                                                    <span class="status-badge status-critical">{{ severity }}</span>
                                                {% elif severity == 'High' %}
                                                    <span class="status-badge status-failed">{{ severity }}</span>
                                                {% elif severity == 'Medium' %}
                                                    <span class="status-badge status-blocked">{{ severity }}</span>
                                                {% else %}
                                                    <span class="status-badge status-passed">{{ severity }}</span>
                                                {% endif %}
                                            </td>
                                            <td>
                                                {% set bug_id = test.get('Bug ID', test.get('BugID', '')) %}
                                                {% if bug_id and bug_id != '' and bug_id != 'nan' %}
                                                    {{ bug_id }}
                                                {% else %}
                                                    <span style="color: #64748b; font-style: italic;">N/A</span>
                                                {% endif %}
                                            </td>
                                            <td>
                                                {% set exec_time = test.get('Duration', test.get('Execution Time (ms)', '')) %}
                                                {% if exec_time and exec_time != '' and exec_time != 'nan' %}
                                                    {{ exec_time }}ms
                                                {% else %}
                                                    <span style="color: #64748b; font-style: italic;">N/A</span>
                                                {% endif %}
                                            </td>
                                        </tr>
                                        {% endif %}
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Test Execution Statistics (Collapsible) -->
            <div class="collapsible-section">
                <button class="collapsible-header" onclick="toggleCollapsible('test-statistics')">
                    <span class="section-title">üìä Test Execution Statistics</span>
                    <span class="toggle-icon">‚ñ∂</span>
                </button>
                <div class="collapsible-content" id="test-statistics">
                    <div class="content-wrapper">
                        <div class="table-container">
                            <h2>Execution Statistics by Module</h2>
                            <table>
                                <thead>
                                    <tr>
                                        <th>Module</th>
                                        <th>Total Tests</th>
                                        <th>Passed</th>
                                        <th>Failed</th>
                                        <th>Pass Rate</th>
                                        <th>Avg Execution Time</th>
                                        <th>Total Execution Time</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for module, data in modules_covered.items() %}
                                    <tr>
                                        <td><strong>{{ module }}</strong></td>
                                        <td>{{ data.total or 0 }}</td>
                                        <td><span class="status-badge status-passed">{{ data.passed or 0 }}</span></td>
                                        <td><span class="status-badge status-failed">{{ data.failed or 0 }}</span></td>
                                        <td>{{ ((data.passed or 0) / (data.total or 1) * 100) | round(1) }}%</td>
                                        <td>
                                            {% set module_tests = test_data | selectattr('Module', 'equalto', module) | list %}
                                            {% set total_time = 0 %}
                                            {% set valid_times = 0 %}
                                            {% for test in module_tests %}
                                                {% set exec_time = test.get('Duration', test.get('Execution Time (ms)', '')) %}
                                                {% if exec_time and exec_time != '' and exec_time != 'nan' %}
                                                    {% set total_time = total_time + (exec_time | int) %}
                                                    {% set valid_times = valid_times + 1 %}
                                                {% endif %}
                                            {% endfor %}
                                            {% if valid_times > 0 %}
                                                {{ "%.0f"|format(total_time / valid_times) }}ms
                                            {% else %}
                                                <span style="color: #64748b; font-style: italic;">N/A</span>
                                            {% endif %}
                                        </td>
                                        <td>
                                            {% if total_time > 0 %}
                                                {{ total_time }}ms
                                            {% else %}
                                                <span style="color: #64748b; font-style: italic;">N/A</span>
                                            {% endif %}
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

        </div>

        <div id="defects" class="tab-content">
            <!-- Defect Analysis Charts (Always Visible) -->
            <div class="table-container">
                <h2>Defect Analysis Charts</h2>
                <div class="charts-section" style="margin-bottom: 2rem;">
                    <div class="charts-grid" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem;">
                        <div class="chart-card" style="background: white; border-radius: 8px; padding: 1rem; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                            <h3 style="margin-bottom: 1rem; color: #1e293b;">Defects by Severity</h3>
                            <img src="assets/defects_by_severity.png" alt="Defect Severity Chart" onclick="openModal('Defects by Severity', 'assets/defects_by_severity.png')" style="width: 100%; height: auto; border-radius: 4px; cursor: pointer;" />
                        </div>
                        <div class="chart-card" style="background: white; border-radius: 8px; padding: 1rem; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                            <h3 style="margin-bottom: 1rem; color: #1e293b;">Defects by Priority</h3>
                            <img src="assets/defects_by_priority.png" alt="Defect Priority Chart" onclick="openModal('Defects by Priority', 'assets/defects_by_priority.png')" style="width: 100%; height: auto; border-radius: 4px; cursor: pointer;" />
                        </div>
                    </div>
                </div>
            </div>

            <!-- Defect Summary (Collapsible) -->
            <div class="collapsible-section">
                <button class="collapsible-header" onclick="toggleCollapsible('defect-summary')">
                    <span class="section-title">üìã Defect Summary</span>
                    <span class="toggle-icon">‚ñ∂</span>
                </button>
                <div class="collapsible-content" id="defect-summary">
                    <div class="content-wrapper">
                        <div class="table-container">
                            <h2>Defect Summary</h2>
                            <table>
                                <thead>
                                    <tr>
                                        <th>Severity</th>
                                        <th>Open</th>
                                        <th>Closed</th>
                                        <th>Deferred</th>
                                        <th>Total</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td><span class="status-badge status-critical"><strong>Critical</strong></span></td>
                                        <td>{{ defects.critical.open or 0 }}</td>
                                        <td>{{ defects.critical.closed or 0 }}</td>
                                        <td>{{ defects.critical.deferred or 0 }}</td>
                                        <td>{{ (defects.critical.open or 0) + (defects.critical.closed or 0) + (defects.critical.deferred or 0) }}</td>
                                    </tr>
                                    <tr>
                                        <td><span class="status-badge status-critical"><strong>Major</strong></span></td>
                                        <td>{{ defects.major.open or 0 }}</td>
                                        <td>{{ defects.major.closed or 0 }}</td>
                                        <td>{{ defects.major.deferred or 0 }}</td>
                                        <td>{{ (defects.major.open or 0) + (defects.major.closed or 0) + (defects.major.deferred or 0) }}</td>
                                    </tr>
                                    <tr>
                                        <td><span class="status-badge status-blocked"><strong>Medium</strong></span></td>
                                        <td>{{ defects.medium.open or 0 }}</td>
                                        <td>{{ defects.medium.closed or 0 }}</td>
                                        <td>{{ defects.medium.deferred or 0 }}</td>
                                        <td>{{ (defects.medium.open or 0) + (defects.medium.closed or 0) + (defects.medium.deferred or 0) }}</td>
                                    </tr>
                                    <tr>
                                        <td><span class="status-badge status-passed"><strong>Minor</strong></span></td>
                                        <td>{{ defects.minor.open or 0 }}</td>
                                        <td>{{ defects.minor.closed or 0 }}</td>
                                        <td>{{ defects.minor.deferred or 0 }}</td>
                                        <td>{{ (defects.minor.open or 0) + (defects.minor.closed or 0) + (defects.minor.deferred or 0) }}</td>
                                    </tr>
                                    <tr style="font-weight: bold; background-color: #f8f9fa;">
                                        <td><strong>Total</strong></td>
                                        <td>{{ (defects.critical.open or 0) + (defects.major.open or 0) + (defects.medium.open or 0) + (defects.minor.open or 0) }}</td>
                                        <td>{{ (defects.critical.closed or 0) + (defects.major.closed or 0) + (defects.medium.closed or 0) + (defects.minor.closed or 0) }}</td>
                                        <td>{{ (defects.critical.deferred or 0) + (defects.major.deferred or 0) + (defects.medium.deferred or 0) + (defects.minor.deferred or 0) }}</td>
                                        <td>{{ (defects.critical.open or 0) + (defects.critical.closed or 0) + (defects.critical.deferred or 0) + (defects.major.open or 0) + (defects.major.closed or 0) + (defects.major.deferred or 0) + (defects.medium.open or 0) + (defects.medium.closed or 0) + (defects.medium.deferred or 0) + (defects.minor.open or 0) + (defects.minor.closed or 0) + (defects.minor.deferred or 0) }}</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Key Bugs Identified (Collapsible) -->
            <div class="collapsible-section">
                <button class="collapsible-header" onclick="toggleCollapsible('key-bugs')">
                    <span class="section-title">üêõ Key Bugs Identified</span>
                    <span class="toggle-icon">‚ñ∂</span>
                </button>
                <div class="collapsible-content" id="key-bugs">
                    <div class="content-wrapper">
                        <div class="table-container">
                            <h2>Key Bugs Identified</h2>
                            <table>
                                <thead>
                                    <tr>
                                        <th>Bug ID</th>
                                        <th>Severity</th>
                                        <th>Priority</th>
                                        <th>Status</th>
                                        <th>Description</th>
                                        <th>Module</th>
                                        <th>Assigned To</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% if key_bugs and key_bugs|length > 0 %}
                                        {% for bug in key_bugs %}
                                            {% if bug and bug.id and bug.id != 'NaN' and bug.id != 'nan' %}
                                            <tr>
                                                <td><strong>{{ bug.id }}</strong></td>
                                                <td><span class="status-badge status-{{ (bug.severity or 'unknown').lower() }}">{{ bug.severity or 'Unknown' }}</span></td>
                                                <td>{{ bug.priority or 'N/A' }}</td>
                                                <td>
                                                    {% set status = (bug.status or 'unknown').lower() %}
                                                    {% if status == 'open' %}
                                                        <span class="status-badge status-open">{{ bug.status or 'Unknown' }}</span>
                                                    {% elif status == 'closed' %}
                                                        <span class="status-badge status-closed">{{ bug.status or 'Unknown' }}</span>
                                                    {% elif status == 'fixed' %}
                                                        <span class="status-badge status-fixed">{{ bug.status or 'Unknown' }}</span>
                                                    {% elif status == 'resolved' %}
                                                        <span class="status-badge status-resolved">{{ bug.status or 'Unknown' }}</span>
                                                    {% elif status == 'verified' %}
                                                        <span class="status-badge status-verified">{{ bug.status or 'Unknown' }}</span>
                                                    {% elif status == 'reopened' %}
                                                        <span class="status-badge status-reopened">{{ bug.status or 'Unknown' }}</span>
                                                    {% elif status == 'in-progress' or status == 'in_progress' %}
                                                        <span class="status-badge status-in-progress">{{ bug.status or 'Unknown' }}</span>
                                                    {% elif status == 'pending' %}
                                                        <span class="status-badge status-pending">{{ bug.status or 'Unknown' }}</span>
                                                    {% else %}
                                                        <span class="status-badge status-blocked">{{ bug.status or 'Unknown' }}</span>
                                                    {% endif %}
                                                </td>
                                                <td>{{ bug.description or 'N/A' }}</td>
                                                <td>{{ bug.module or 'N/A' }}</td>
                                                <td>{{ bug.assigned_to or 'N/A' }}</td>
                                            </tr>
                                            {% endif %}
                                        {% endfor %}
                                    {% else %}
                                        <tr>
                                            <td colspan="7" style="text-align: center; color: #64748b; padding: 2rem;">No key bugs identified</td>
                                        </tr>
                                    {% endif %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Defect Trends (Collapsible) -->
            <div class="collapsible-section">
                <button class="collapsible-header" onclick="toggleCollapsible('defect-trends')">
                    <span class="section-title">üìà Defect Trends & Analysis</span>
                    <span class="toggle-icon">‚ñ∂</span>
                </button>
                <div class="collapsible-content" id="defect-trends">
                    <div class="content-wrapper">
                        <!-- Defect Distribution by Module -->
                        <div class="table-container">
                            <h2>Defect Distribution by Module</h2>
                            <table>
                                <thead>
                                    <tr>
                                        <th>Module</th>
                                        <th>Total Defects</th>
                                        <th>Critical</th>
                                        <th>Major</th>
                                        <th>Medium</th>
                                        <th>Minor</th>
                                        <th>Defect Rate</th>
                                        <th>Risk Level</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for module, data in density.items() %}
                                    <tr>
                                        <td><strong>{{ module }}</strong></td>
                                        <td>{{ data.get('total', 0) }}</td>
                                        <td>
                                            <span class="status-badge status-critical">{{ data.get('critical', 0) }}</span>
                                        </td>
                                        <td>
                                            <span class="status-badge status-failed">{{ data.get('major', 0) }}</span>
                                        </td>
                                        <td>
                                            <span class="status-badge status-blocked">{{ data.get('medium', 0) }}</span>
                                        </td>
                                        <td>
                                            <span class="status-badge status-passed">{{ data.get('minor', 0) }}</span>
                                        </td>
                                        <td>{{ "%.1f"|format(data.get('density_percentage', 0)) }}%</td>
                                        <td>
                                            {% set risk_level = data.get('risk_level', 'Low') %}
                                            {% if risk_level == 'High' %}
                                                <span class="status-badge status-critical" style="background: #fef2f2; color: #dc2626; border: 1px solid #fecaca;">{{ risk_level }}</span>
                                            {% elif risk_level == 'Medium' %}
                                                <span class="status-badge status-failed" style="background: #fef3c7; color: #d97706; border: 1px solid #fde68a;">{{ risk_level }}</span>
                                            {% else %}
                                                <span class="status-badge status-passed" style="background: #f0fdf4; color: #166534; border: 1px solid #bbf7d0;">{{ risk_level }}</span>
                                            {% endif %}
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>

                        <!-- Defect Severity Analysis -->
                        <div class="table-container">
                            <h2>Defect Severity Analysis</h2>
                            <div style="padding: 1.5rem;">
                                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
                                    <div style="background: #fef2f2; border: 1px solid #fecaca; border-radius: 8px; padding: 1rem; text-align: center;">
                                        <div style="font-size: 1.5rem; font-weight: bold; color: #dc2626;">{{ defects_by_severity.get('Critical', 0) }}</div>
                                        <div style="color: #64748b;">Critical Defects</div>
                                        <div style="font-size: 0.8rem; color: #dc2626; margin-top: 0.5rem;">Immediate Action Required</div>
                                    </div>
                                    <div style="background: #fef3c7; border: 1px solid #fde68a; border-radius: 8px; padding: 1rem; text-align: center;">
                                        <div style="font-size: 1.5rem; font-weight: bold; color: #d97706;">{{ defects_by_severity.get('Major', 0) }}</div>
                                        <div style="color: #64748b;">Major Defects</div>
                                        <div style="font-size: 0.8rem; color: #d97706; margin-top: 0.5rem;">High Priority</div>
                                    </div>
                                    <div style="background: #fef3c7; border: 1px solid #fde68a; border-radius: 8px; padding: 1rem; text-align: center;">
                                        <div style="font-size: 1.5rem; font-weight: bold; color: #d97706;">{{ defects_by_severity.get('Medium', 0) }}</div>
                                        <div style="color: #64748b;">Medium Defects</div>
                                        <div style="font-size: 0.8rem; color: #d97706; margin-top: 0.5rem;">Medium Priority</div>
                                    </div>
                                    <div style="background: #f0fdf4; border: 1px solid #bbf7d0; border-radius: 8px; padding: 1rem; text-align: center;">
                                        <div style="font-size: 1.5rem; font-weight: bold; color: #166534;">{{ defects_by_severity.get('Minor', 0) }}</div>
                                        <div style="color: #64748b;">Minor Defects</div>
                                        <div style="font-size: 0.8rem; color: #166534; margin-top: 0.5rem;">Low Priority</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Defect Priority Analysis - HIDDEN -->
                        <!--
                        <div class="table-container">
                            <h2>Defect Priority Distribution</h2>
                            <table>
                                <thead>
                                    <tr>
                                        <th>Priority Level</th>
                                        <th>Count</th>
                                        <th>Percentage</th>
                                        <th>Action Required</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for priority, count in defects_by_priority.items() %}
                                    <tr>
                                        <td><strong>{{ priority }}</strong></td>
                                        <td>{{ count }}</td>
                                        <td>{{ "%.1f"|format((count / (defects_by_priority.values() | sum)) * 100) }}%</td>
                                        <td>
                                            {% if priority == 'Highest' %}
                                                <span class="status-badge status-critical">Immediate</span>
                                            {% elif priority == 'High' %}
                                                <span class="status-badge status-failed">Within 24h</span>
                                            {% elif priority == 'Medium' %}
                                                <span class="status-badge status-blocked">Within 3 days</span>
                                            {% else %}
                                                <span class="status-badge status-passed">Next Sprint</span>
                                            {% endif %}
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                        -->

                        <!-- Defect Trend Summary -->
                        <div class="table-container">
                            <h2>Defect Trend Summary</h2>
                            <div style="padding: 1.5rem;">
                                <h3>Key Insights</h3>
                                <ul>
                                    <li><strong>Total Defects:</strong> {{ defects_by_severity.values() | sum }} defects identified across {{ fail_by_module.keys() | list | length }} modules</li>
                                    <li><strong>Critical Issues:</strong> {{ defects_by_severity.get('Critical', 0) }} critical defects require immediate attention</li>
                                    <li><strong>Most Affected Module:</strong> {{ fail_by_module.items() | max(attribute=1) | first }} with {{ fail_by_module.items() | max(attribute=1) | last }} defects</li>
                                    <li><strong>Defect Density:</strong> {{ "%.1f"|format((defects_by_severity.values() | sum) / (total_tests) * 100) }}% of test cases resulted in defects</li>
                                </ul>
                                
                                <div style="margin: 2rem 0;"></div>
                                
                                <h3>Recommendations</h3>
                                <ul>
                                    {% if defects_by_severity.get('Critical', 0) > 0 %}
                                    <li>üî¥ <strong>Critical Priority:</strong> Address {{ defects_by_severity.get('Critical', 0) }} critical defects before release</li>
                                    {% endif %}
                                    {% if fail_by_module.items() | max(attribute=1) | last > 3 %}
                                    <li>üü° <strong>Module Focus:</strong> {{ fail_by_module.items() | max(attribute=1) | first }} module needs additional testing and debugging</li>
                                    {% endif %}
                                    <li>üü¢ <strong>Quality Improvement:</strong> Implement additional test coverage for high-defect areas</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>

        <div id="signoff" class="tab-content">
            <!-- Release Decision -->
            <div class="table-container">
                <h2>Release Decision</h2>
                <div style="padding: 1.5rem;">
                    <h3>Release Recommendation</h3>
                    <p><strong>Release Recommendation:</strong> 
                        <span class="status-badge status-{{ quality_gate_evaluation.release_recommendation.lower() }}" style="display: inline-block; padding: 0.25rem 0.75rem; border-radius: 9999px; font-size: 0.8rem; font-weight: 500; text-transform: uppercase; letter-spacing: 0.05em; background: {% if quality_gate_evaluation.release_recommendation == 'REJECTED' %}#fef2f2; color: #dc2626;{% elif quality_gate_evaluation.release_recommendation == 'CONDITIONAL' %}#fef3c7; color: #d97706;{% else %}#dcfce7; color: #166534;{% endif %}">
                            {{ quality_gate_evaluation.release_recommendation }}
                        </span>
                    </p>
                    <p><strong>Comments:</strong> Based on test execution results and exit criteria evaluation</p>
                </div>
            </div>

            <!-- Sign-off Information -->
            <div class="table-container">
                <h2>Sign-Off</h2>
                <div style="padding: 1.5rem;">
                    <table style="width: 100%; border-collapse: collapse;">
                        <tr>
                            <td style="padding: 0.5rem; border: 1px solid #e2e8f0;"><strong>Test Team</strong></td>
                            <td style="padding: 0.5rem; border: 1px solid #e2e8f0;"><strong>Development Team</strong></td>
                            <td style="padding: 0.5rem; border: 1px solid #e2e8f0;"><strong>Product Owner</strong></td>
                            <td style="padding: 0.5rem; border: 1px solid #e2e8f0;"><strong>Quality Assurance</strong></td>
                        </tr>
                        <tr>
                            <td style="padding: 0.5rem; border: 1px solid #e2e8f0;">Test Lead: {{ sign_off.test_lead or 'TBD' }}</td>
                            <td style="padding: 0.5rem; border: 1px solid #e2e8f0;">Development Lead: {{ sign_off.dev_lead or 'TBD' }}</td>
                            <td style="padding: 0.5rem; border: 1px solid #e2e8f0;">Product Owner: {{ sign_off.product_owner or 'TBD' }}</td>
                            <td style="padding: 0.5rem; border: 1px solid #e2e8f0;">QA Manager: {{ sign_off.qa_manager or 'TBD' }}</td>
                        </tr>
                        <tr>
                            <td style="padding: 0.5rem; border: 1px solid #e2e8f0;">Test Engineer: {{ sign_off.test_engineer or 'TBD' }}</td>
                            <td style="padding: 0.5rem; border: 1px solid #e2e8f0;">Date: {{ sign_off.dev_date or 'TBD' }}</td>
                            <td style="padding: 0.5rem; border: 1px solid #e2e8f0;">Date: {{ sign_off.product_date or 'TBD' }}</td>
                            <td style="padding: 0.5rem; border: 1px solid #e2e8f0;">Date: {{ sign_off.qa_date or 'TBD' }}</td>
                        </tr>
                        <tr>
                            <td style="padding: 0.5rem; border: 1px solid #e2e8f0;">Date: {{ sign_off.test_date or generated_at.split(' ')[0] }}</td>
                            <td style="padding: 0.5rem; border: 1px solid #e2e8f0;"></td>
                            <td style="padding: 0.5rem; border: 1px solid #e2e8f0;"></td>
                            <td style="padding: 0.5rem; border: 1px solid #e2e8f0;"></td>
                        </tr>
                    </table>
                </div>
            </div>

        </div>
    </div>

    <!-- Modal for image viewing -->
    <div id="imageModal" style="display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.8);">
        <div style="position: relative; margin: auto; padding: 0; width: 80%; max-width: 700px; top: 50%; transform: translateY(-50%);">
            <span onclick="closeModal()" style="position: absolute; top: 15px; right: 35px; color: #f1f1f1; font-size: 40px; font-weight: bold; cursor: pointer;">&times;</span>
            <img id="modalImage" style="width: 100%; height: auto; border-radius: 8px;">
        </div>
    </div>

    <script>
        function showTab(tabName) {
            // Hide all tab contents
            var tabContents = document.getElementsByClassName('tab-content');
            for (var i = 0; i < tabContents.length; i++) {
                tabContents[i].classList.remove('active');
            }
            
            // Remove active class from all tab buttons
            var tabButtons = document.getElementsByClassName('tab-button');
            for (var i = 0; i < tabButtons.length; i++) {
                tabButtons[i].classList.remove('active');
            }
            
            // Show selected tab content
            document.getElementById(tabName).classList.add('active');
            
            // Add active class to clicked button (find the button element, not just the target)
            var clickedButton = event.target;
            while (clickedButton && !clickedButton.classList.contains('tab-button')) {
                clickedButton = clickedButton.parentElement;
            }
            if (clickedButton) {
                clickedButton.classList.add('active');
            }
        }
        
        function openModal(title, imageSrc) {
            document.getElementById('imageModal').style.display = 'block';
            document.getElementById('modalImage').src = imageSrc;
            document.title = title + ' - TSR';
        }
        
        function closeModal() {
            document.getElementById('imageModal').style.display = 'none';
        }
        
        // Close modal when clicking outside the image
        window.onclick = function(event) {
            var modal = document.getElementById('imageModal');
            if (event.target == modal) {
                modal.style.display = 'none';
            }
        }
        
        // Collapsible sections functionality
        function toggleCollapsible(sectionId) {
            var content = document.getElementById(sectionId);
            var icon = event.target.querySelector('.toggle-icon');
            
            if (content.classList.contains('collapsed')) {
                content.classList.remove('collapsed');
                icon.textContent = '‚ñº';
            } else {
                content.classList.add('collapsed');
                icon.textContent = '‚ñ∂';
            }
        }
        
        // Initialize collapsible sections (all open by default)
        document.addEventListener('DOMContentLoaded', function() {
            var collapsibleHeaders = document.querySelectorAll('.collapsible-header');
            collapsibleHeaders.forEach(function(header) {
                var icon = header.querySelector('.toggle-icon');
                if (icon) {
                    icon.textContent = '‚ñº';
                }
            });
        });
        
        // Keyboard navigation
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                closeModal();
            }
        });
    </script>
</body>
</html>